/**
 * 合并对象
 */var isPause=!0;window.extend=function(){if(0==arguments.length)return{};if(Object.assign)return Object.assign.apply({},arguments);var a={},b;for(b in arguments)for(var c in arguments[b])a[c]=arguments[b][c];return a};(function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),f=Math.max(0,16.7-(d-a)),h=window.setTimeout(function(){b(d+f)},f);a=d+f;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();window.Set=function(){this.arr=[]};Set.prototype={size:function(){return this.arr.length},add:function(a){for(var b=!0,c=0;c<this.size();c++)if(this.arr[c]===a){b=!1;break}b&&this.arr.push(a)},"delete":function(a){var b=[];this.forEach(function(c){c===a||b.push(c)});this.arr=b},has:function(a){for(var b=null,c=0;c<this.size();c++)if(this.arr[c]===a){b=a;break}return b===a},clear:function(){this.arr.length=0},forEach:function(a){this.arr.forEach(a)}};window.Tools={checkIntersects:function(a,b){var c=a[0]+a[2],d=a[1],f=a[1]+a[3],e=b[0],g=b[1],h=b[1]+b[3];return!(a[0]>b[0]+b[2]||c<e||d>h||f<g)},fps_lastTime:0,requestAnimFrame:function(a,b){var c=1E3/60,d=(new Date).getTime(),c=Tools.fps_lastTime?d-Tools.fps_lastTime:c;Tools.fps_lastTime=d;a&&requestAnimationFrame(function(){a(d,1E3/c)})}};var Frame=function(a,b,c){this.cvWidth=a;this.cvHeight=b;this.canvas=document.getElementById("canvas");this.canvas.width=this.cvWidth;this.canvas.height=this.cvHeight;this.context=canvas.getContext("2d");this.progress_int=0;this.allImgNum_int=c||0};Frame.prototype={getImg:function(a){var b=this,c=new Image;c.onload=function(){b.progress_int++};c.onerror=function(){console.log("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\uff1a"+a)};c.src=a;return c},_init:function(a){function b(){c._draw();c.progress_int<c.allImgNum_int?Tools.requestAnimFrame(b):(c.context.restore(),a.showFrame())}var c=this;c.context.save();b()},_draw:function(){var a=.1*this.cvWidth,b=.4*this.cvHeight,c=.8*this.cvWidth,d=this.progress_int/this.allImgNum_int,f=parseInt(c*d),e=this.context;e.shadowBlur=40;e.shadowColor="#999";e.beginPath();e.fillStyle="#c7edfe";e.fillRect(0,0,this.cvWidth,this.cvHeight);e.closePath();e.beginPath();e.lineJoin="round";var g=e.createLinearGradient(0,b,0,b+12);g.addColorStop(0,"#333");g.addColorStop(.4,"#999");g.addColorStop(1,"#333");e.fillStyle=g;e.fillRect(a,b,f,12);e.closePath();e.beginPath();e.strokeStyle="#333";e.lineWidth=3;e.lineJoin="round";e.strokeRect(a,b,c,12);e.closePath();e.beginPath();g=e.createLinearGradient(0,b+24,0,b+36);g.addColorStop(0,"#333");g.addColorStop(.4,"#999");g.addColorStop(1,"#333");e.fillStyle=g;e.textAlign="center";e.font="35px Arial";e.fillText(parseInt(100*d)+"%",.5*this.cvWidth,b+48);e.closePath()}};var BackGround=function(a,b,c,d,f,e,g){this.img=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.v_float=e;this.gs=g};BackGround.prototype={draw:function(a){this.gs.context.drawImage(this.img,this.x_int,this.y_int,this.w_int,this.h_int)},move:function(a){}};var Bomb=function(a,b,c,d,f,e){this.img_arry=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.gs=e;this.fps_num=0};Bomb.prototype={draw:function(){var a=this.img_arry,b=this.x_int,c=this.y_int,d=this.w_int,f=this.h_int;this.gs.context.drawImage(a[this.fps_num++],b,c,d,f);this.fps_num==a.length&&this.gs.bo_set["delete"](this)}};var MyPlane=function(a,b,c,d,f,e,g,h){this.img=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.v_float=e;this.hp_int=g;this.gs=h;this.isRight_bool=this.isLeft_bool=this.isDown_bool=this.isUp_bool=!1;this.range=[0-d/3,0,this.gs.cvWidth-2*d/3,this.gs.cvHeight-f]};MyPlane.prototype={draw:function(a){var b=this.img,c=this.x_int,d=this.y_int,f=this.w_int,e=this.h_int;0<this.hp_int?(this.gs.context.drawImage(b,c,d,f,e),this.move(a)):(a=new Bomb(this.gs.bomb_img,c,d,f,e,this.gs),this.gs.bo_set.add(a),this.hp_int=1,state=2)},move:function(a){var b=this.isUp_bool,c=this.isDown_bool,d=this.isLeft_bool,f=this.isRight_bool;a=this.v_float/a;!b||c||d||f?b||c||d||!f?b||!c||d||f?b||c||!d||f?b&&!c&&d&&!f?(this.y_int>this.range[1]&&(this.y_int-=a),this.x_int>this.range[0]&&(this.x_int-=a)):b&&!c&&!d&&f?(this.y_int>this.range[1]&&(this.y_int-=a),this.x_int<this.range[2]&&(this.x_int+=a)):!b&&c&&d&&!f?(this.y_int<this.range[3]&&(this.y_int+=a),this.x_int>this.range[0]&&(this.x_int-=a)):!b&&c&&!d&&f&&(this.y_int<this.range[3]&&(this.y_int+=a),this.x_int<this.range[2]&&(this.x_int+=a)):this.x_int>this.range[0]&&(this.x_int-=a):this.y_int<this.range[3]&&(this.y_int+=a):this.x_int<this.range[2]&&(this.x_int+=a):this.y_int>this.range[1]&&(this.y_int-=a)},mouseMove:function(a,b){this.y_int=b-this.h_int/2;this.x_int=a-this.w_int/2},keyDown:function(a){switch(a){case 37:this.isLeft_bool=!0;break;case 38:this.isUp_bool=!0;break;case 39:this.isRight_bool=!0;break;case 40:this.isDown_bool=!0}},keyUp:function(a){switch(a){case 37:this.isLeft_bool=!1;break;case 38:this.isUp_bool=!1;break;case 39:this.isRight_bool=!1;break;case 40:this.isDown_bool=!1}},getRept:function(){return[this.x_int,this.y_int+.2*this.h_int,this.w_int,.6*this.h_int]},checkToEpBump:function(){var a=this;this.gs.ep_set.forEach(function(b){Tools.checkIntersects(a.getRept(),b.getRept())&&0<b.hp_int&&0<a.hp_int&&(a.hp_int-=b.hurt_int,b.hp_int=0)})}};var Bullet=function(a,b,c,d,f,e,g,h,k,l){this.img=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.vx_float=e;this.vy_float=g;this.hurt_int=h;this.isLife_bool=k;this.gs=l};Bullet.prototype={move:function(a){this.y_int-=this.vy_float/a;this.x_int-=this.vx_float/a;this.y_int<0-this.h_int&&(this.isLife_bool=!1)},draw:function(a){var b=this.img,c=this.x_int,d=this.y_int,f=this.w_int,e=this.h_int;this.isLife_bool?(this.gs.context.drawImage(b,c,d,f,e),this.move(a)):this.gs.bt_set["delete"](this)},getRept:function(){return[this.x_int,this.y_int+.2*this.h_int,this.w_int,.6*this.h_int]},checkToEpBump:function(){var a=this;this.gs.ep_set.forEach(function(b){Tools.checkIntersects(a.getRept(),b.getRept())&&0<b.hp_int&&a.isLife_bool&&(a.isLife_bool=!1,b.hp_int-=a.hurt_int)})}};var EnemyPlane=function(a,b,c,d,f,e,g,h,k,l){this.img=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.v_float=e;this.hp_int=g;this.hurt_int=h;this.score=k;this.gs=l};EnemyPlane.prototype={move:function(a){this.y_int+=this.v_float/a;this.y_int>this.gs.cvHeight+this.h_int&&(this.hp_int=0)},draw:function(a){var b=this.img,c=this.x_int,d=this.y_int,f=this.w_int,e=this.h_int;0<this.hp_int?(this.gs.context.drawImage(b,c,d,f,e),this.move(a)):(this.gs.ep_set["delete"](this),this.gs.score_int+=this.score,0>=this.hp_int&&d<this.gs.cvHeight&&(a=new Bomb(this.gs.bomb_img,c,d,f,e,this.gs),this.gs.bo_set.add(a),bombAmount++))},getRept:function(){return[this.x_int,this.y_int+.2*this.h_int,this.w_int,.6*this.h_int]}};var Ww=window.innerWidth,Wh=.7*window.innerHeight,state=0,bombAmount=0,GameStart=function(){Frame.call(this,Ww,Wh,21);this.plane_img=this.getImg("js/canvas_zh/image/self.png");this.plane_img69=this.getImg("js/canvas_zh/image/self69.png");this.bg_img=this.getImg("js/canvas_zh/image/bg0.png");this.enemy_img=[this.getImg("js/canvas_zh/image/f1-1.png"),this.getImg("js/canvas_zh/image/f2.png"),this.getImg("js/canvas_zh/image/f3.png")];this.bullet_img1=this.getImg("js/canvas_zh/image/bullet.png");this.pauseing=this.getImg("js/canvas_zh/image/pause.png");this.pauseAlert=this.getImg("js/canvas_zh/image/pauseAlert.png");this.bomb_img=[this.getImg("js/canvas_zh/image/b11.gif"),this.getImg("js/canvas_zh/image/b10.gif"),this.getImg("js/canvas_zh/image/b9.gif"),this.getImg("js/canvas_zh/image/b8.gif"),this.getImg("js/canvas_zh/image/b7.gif"),this.getImg("js/canvas_zh/image/b6.gif"),this.getImg("js/canvas_zh/image/b5.gif"),this.getImg("js/canvas_zh/image/b4.gif"),this.getImg("js/canvas_zh/image/b3.gif"),this.getImg("js/canvas_zh/image/b2.gif"),this.getImg("js/canvas_zh/image/b1.gif")];this.cloud_img=[this.getImg("js/canvas_zh/image/cloud02.png"),this.getImg("js/canvas_zh/image/cloud01.png")];var a=(new Date).getTime();this.ep_set=new Set;this.bt_set=new Set;this.bo_set=new Set;this.score_int=0;this.pl_hp=1;this.myPlane=new MyPlane(this.plane_img,(this.cvWidth-36)/2,this.cvHeight-42-50,36,42,240,this.pl_hp,this);this.ep_hp=[5,10,15];this.ep_w=[27,43,49];this.ep_h=[42,46,46];this.ep_vy=[200,160,120];this.ep_hurt=[10,20,30];this.ep_score=[10,20,30];this.ep_intterval=[1E3,4E3,6E3];this.ep_time=[a,a,a];this.bt_w=5;this.bt_h=9;this.bt_vx=0;this.bt_vy=600;this.bt_hurt=5;this.bt_intterval=300;this.bt_time=a;this.bg1=new BackGround(this.bg_img,0,0,this.cvWidth,this.cvHeight,42,this);this.creatCloud();this._init(this)};GameStart.prototype=extend(Frame.prototype,{showFrame:function(){function a(c,d){isPause||Tools.requestAnimFrame(a,isPause);b.draw(c,d)}var b=this;isPause=!0;window.addEventListener("keydown",function(a){b.myPlane.keyDown((a||window.event).keyCode)});$(window).scroll(function(){var a=$("#canvas").offset().top,b=$(document).scrollTop();1==state&&(a>b+Wh/2||a+Wh/2<b)&&(isPause=!0)});b.canvas.addEventListener("click",function(b){isPause&&(isPause=!1,Tools.fps_lastTime=0,a((new Date).getTime(),1E3/60))});b.canvas.addEventListener("blur",function(){isPause=!0});b.canvas.addEventListener("focus",function(){isPause=!1;Tools.fps_lastTime=0;a((new Date).getTime(),1E3/60)});b.canvas.addEventListener("mousemove",function(a){a=a||window.event;b.myPlane.mouseMove(a.offsetX,a.offsetY)});b.canvas.addEventListener("touchmove",function(a){a=(a||window.event).changedTouches[0];b.myPlane.mouseMove(a.pageX,a.pageY)});a((new Date).getTime(),1E3/60)},draw:function(a,b){this.start(b);canvas.addEventListener("touchstart",function(a){0==state?state=1:2==state&&(bombAmount=0,state=1)});canvas.addEventListener("click",function(a){0==state?state=1:2==state&&(bombAmount=0,state=1)});switch(state){case 1:this.gaming(a,b);break;case 2:this.over()}},start:function(a){this.bg1.draw(a);this.cl1.draw(3);this.cl2.draw(3);this.context.drawImage(this.plane_img69,.43*Ww-this.plane_img69.width/2,.33*Wh);this.context.drawImage(this.plane_img69,Ww-.43*Ww-this.plane_img69.width/2,.33*Wh);this.context.drawImage(this.enemy_img[2],Ww/2-this.enemy_img[2].width/2,.36*Wh);this.context.drawImage(this.enemy_img[1],.38*Ww-this.enemy_img[2].width/2,.24*Wh);this.context.drawImage(this.enemy_img[1],Ww-.38*Ww-this.enemy_img[2].width/2,.24*Wh);this.context.drawImage(this.enemy_img[0],Ww-.33*Ww-this.enemy_img[0].width/2,.16*Wh);this.context.drawImage(this.enemy_img[0],.33*Ww-this.enemy_img[0].width/2,.16*Wh);this.context.textAlign="center";this.context.font="bold "+.01*Ww+"px \u5fae\u8f6f\u96c5\u9ed1";this.context.fillText("\u70b9\u51fb\u4efb\u610f\u533a\u57df\u5f00\u542f\u6e38\u620f",Ww/2,Wh/1.8);this.context.drawImage(this.pauseAlert,Ww-1.1*this.pauseAlert.width,.9*Wh)},gaming:function(a,b){this.bg1.draw(b);this.cl1.draw(3);this.cl2.draw(3);this.context.drawImage(this.pauseAlert,Ww-1.1*this.pauseAlert.width,.9*Wh);a-this.bt_time>this.bt_intterval&&(this.creatBullet(),this.bt_time=a);a-this.ep_time[2]>this.ep_intterval[2]&&(this.creatEnemyPlane(2),this.ep_time[2]=a);a-this.ep_time[1]>this.ep_intterval[1]&&(this.creatEnemyPlane(1),this.ep_time[1]=a);a-this.ep_time[0]>this.ep_intterval[0]&&(this.creatEnemyPlane(0),this.ep_time[0]=a);this.ep_set.forEach(function(a){a.draw(b)});this.bo_set.forEach(function(a){a.draw(b)});this.bt_set.forEach(function(a){a.draw(b);a.checkToEpBump()});this.myPlane.draw(b);this.myPlane.checkToEpBump();this.showScore();isPause&&canvas.getContext("2d").drawImage(this.pauseing,Ww/2-this.pauseing.width/2,Wh/2-this.pauseing.height/2)},over:function(){this.context.drawImage(this.bg_img,0,0,Ww,Wh);this.context.fillStyle="#000";this.context.font=.03*Ww+"px \u5fae\u8f6f\u96c5\u9ed1";this.context.textAlign="center";this.context.fillText("GAME OVER",Ww/2,Wh/3);this.context.font=.01*Ww+"px \u5fae\u8f6f\u96c5\u9ed1";this.context.fillText("\u4f60\u6210\u529f\u51fb\u843d "+bombAmount+" \u67b6\u98de\u673a\uff0c\u70b9\u51fb\u6e38\u620f\u533a\u57df\u91cd\u65b0\u5f00\u59cb",Ww/2,Wh/2.2);this.score_int=0},showScore:function(){var a=.8*this.cvWidth,b=.065*this.cvHeight;this.context.fillStyle="#5fb9de";this.context.fillText("Score:"+this.score_int,a,b)},creatBullet:function(){var a=this.myPlane;if(!(0>=a.hp_int)){var b=this.bt_w,c=this.bt_h,a=new Bullet(this.bullet_img1,a.x_int+(a.w_int-b)/2,a.y_int-c,b,c,this.bt_vx,this.bt_vy,this.bt_hurt,!0,this);this.bt_set.add(a)}},creatEnemyPlane:function(a){if(!(0>=this.myPlane.hp_int)){var b=this.enemy_img[a],c=this.ep_w[a],d=this.ep_h[a],f=parseInt(Math.random()*(this.cvWidth-c));a=new EnemyPlane(b,f,0-d,c,d,this.ep_vy[a],this.ep_hp[a],this.ep_hurt[a],this.ep_score[a],this);this.ep_set.add(a)}},creatCloud:function(){var a=this.cloud_img[0];this.cl2=new Cloud(this.cloud_img[1],.1*Ww,0,129,80,Wh,this);this.cl1=new Cloud(a,.7*Ww,Wh/2,72,40,Wh,this)}});var Cloud=function(a,b,c,d,f,e,g){this.img=a;this.x_int=b;this.y_int=c;this.w_int=d;this.h_int=f;this.Wh_int=e;this.gs=g};Cloud.prototype={draw:function(a){this.gs.context.drawImage(this.img,this.x_int,this.y_int,this.w_int,this.h_int);this.move(a)},move:function(){this.y_int>=this.Wh_int&&(this.y_int=-this.h_int);this.y_int+=3}};